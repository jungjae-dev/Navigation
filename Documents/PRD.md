# Navigation App - Product Requirements Document

## 1. 프로젝트 개요

### 앱 이름
(추후 확정)

### 비전
기존 네비게이션 앱의 과도한 기능과 복잡한 UI를 덜어낸, **심플하고 직관적인 네비게이션 앱**.
사용자가 목적지를 검색하고 안내를 시작하기까지 최소한의 단계만 필요한 미니멀 경험을 제공한다.

### 핵심 가치
- **Simple** - 불필요한 기능 없이 네비게이션 본질에 집중
- **Clean** - 깔끔하고 읽기 쉬운 UI, 운전 중에도 한눈에 파악
- **Fast** - 앱 실행 → 목적지 설정 → 안내 시작까지 3탭 이내
- **Clear** - 헷갈리는 분기점, 주차장 진입 등 핵심 순간에 명확한 안내
- **Smooth** - 끊김 없는 부드러운 지도 렌더링과 차량 이동 표현

---

## 2. 타겟 사용자

| 구분 | 설명 |
|------|------|
| 주요 타겟 | 복잡한 네비 앱에 피로감을 느끼는 사용자 |
| 사용 시나리오 | 일상 출퇴근, 처음 가는 장소, 도보 이동 |
| 디바이스 | iPhone + CarPlay |

---

## 3. 플랫폼 & 기술 스택

| 항목 | 선택 |
|------|------|
| 플랫폼 | iOS 17+ |
| 언어 | Swift |
| UI | SwiftUI + UIKit 혼합 |
| 지도 | Apple MapKit |
| 경로 탐색 | MKDirections |
| 위치 추적 | CoreLocation |
| 음성 안내 | AVSpeechSynthesizer |
| CarPlay | CarPlay Framework (CPNavigationSession) |
| 로컬 DB | (추후 확정 - SwiftData / Realm) |
| 아키텍처 | (추후 확정) |

---

## 4. 지원 이동 수단

| 이동 수단 | 지원 | 비고 |
|-----------|:---:|------|
| 자동차 | ✅ | CarPlay 포함, 메인 기능 |
| 도보 | ✅ | 걸어서 목적지까지 안내 |
| 대중교통 | ❌ | Apple API 한국 지원 제한으로 제외 |
| 자전거 | ❌ | Apple API 미지원 |

---

## 5. 핵심 기능 (MVP)

### 5.1 장소 검색
- **"여기서 검색" 컨셉**: 현재 지도에 보이는 영역(visible region) 기반으로 검색
- 지도를 이동/줌하면 해당 영역 기준으로 검색 결과 갱신
- 검색 바 탭 시 자동완성 모드 활성화 (MKLocalSearchCompleter)
- 텍스트 입력 없이 검색 바 탭만 해도 최근 검색 + 즐겨찾기 표시
- 검색 실행 시:
  - 결과를 지도 위에 **마커**로 표시
  - 하단에 **드로어(Bottom Sheet)** 로 결과 리스트 표시
  - 드로어는 최소/중간/전체 3단계 높이로 동작
  - 드로어 내부는 별도 스크롤 가능한 리스트
  - **리스트 최상단 항목 → 지도에서 해당 마커 포커싱** (카메라 이동 + 마커 강조)
  - 리스트 스크롤 시 상단에 보이는 항목이 바뀌면 지도 포커스도 자동 전환
- 마커 탭 시 해당 항목이 드로어 리스트에서 하이라이트
- 즐겨찾기 장소 (집, 회사 등) 빠른 접근

### 5.2 경로 탐색
- 출발지(현재 위치) → 목적지 경로 계산
- 대안 경로 표시 (최대 3개)
- 경로별 예상 소요 시간 / 거리 표시
- 경로 선택 후 안내 시작
- 자동차 / 도보 모드 전환

### 5.3 Turn-by-Turn 네비게이션
- 실시간 위치 추적 + 경로 따라가기
- 다음 회전 안내 (방향, 거리)
- 남은 거리 / 예상 도착 시간 표시
- 경로 이탈 감지 (50m 기준)
- 자동 재경로 탐색 (Rerouting)
- 현재 속도 표시

### 5.4 음성 안내
- 한국어 TTS 음성 안내
- 안내 타이밍: 300m 전 → 100m 전 → 직전
- 음성 안내 ON/OFF 토글
- 다른 앱 오디오와 공존 (duck audio)

### 5.5 CarPlay 지원
- CarPlay 지도 화면
- 장소 검색 (CarPlay UI)
- Turn-by-Turn 안내 (CPManeuver)
- 경로 미리보기
- 즐겨찾기 빠른 접근

### 5.6 지도 화면
- 현재 위치 표시
- 경로 폴리라인 표시
- 출발지/목적지 마커
- 카메라 자동 추적 (진행 방향 기준)
- 수동 지도 조작 시 추적 해제 → 재추적 버튼
- 줌 인/아웃

### 5.7 팝업 안내 (회전 지점 + 목적지 도착)
- **공통 팝업 동작**: 메인 지도 위에 **정북 고정 2D 탑뷰 팝업**으로 안내
  - 메인 지도(3D 진행방향 시점)는 그대로 유지
  - 팝업은 **정북 고정 2D 탑뷰** (위에서 내려다보는 시점)
  - **팝업 지도 중심 = 목표 지점 좌표 (고정)**, 차량을 따라가지 않음
  - **줌 레벨**: 300m 전 차량 위치부터 목표 지점까지 **모두 화면에 들어오는 범위**로 설정
  - 차량 마커가 팝업 지도 가장자리에서 출발 → **중심(목표 지점)을 향해 실시간으로 이동**
  - **차량 위치는 raw GPS 좌표 그대로 표시** (경로에 스냅하지 않음) — 실제 내 위치를 리얼하게 파악
  - 주행 경로(polyline)를 강조색으로 표시하여 어디로 가야 하는지 명확히 안내
- **회전 지점 팝업**: 회전/분기 지점 접근 시 (300m 전)
  - 중심 = 회전 지점 좌표
  - 차량이 회전 지점을 통과하는 모습이 리얼하게 보임
  - 회전 지점 통과 후 팝업 자동 닫기
- **목적지 도착 팝업**: 목적지 접근 시 (300m 전)
  - 중심 = 목적지 좌표
  - 목적지 마커 강조 표시
  - 건물 밀집 지역에서 정확한 진입로와 도착 위치를 2D 탑뷰로 명확하게 안내
  - 차량이 목적지를 향해 접근하는 모습이 리얼하게 보임
  - 도착 판정 시 팝업 닫기 + 도착 안내

### 5.8 부드러운 지도 표현 (Smooth Rendering)
- 차량 아이콘 이동 시 **프레임 기반 Interpolation** 적용 (GPS 업데이트 간 위치 보간)
- 지도 카메라 회전/이동 시 부드러운 전환 (heading, altitude, center 모두 보간)
- GPS 업데이트 주기(1Hz)와 화면 렌더링 주기(60fps) 차이를 보간으로 해소
- 급격한 방향 전환 시에도 자연스러운 애니메이션

### 5.9 커스텀 차량 아이콘
- **Lift Subject 이미지**: 사용자가 실제 자기 차 사진에서 배경을 제거(iOS Vision API)하여 차량 아이콘으로 사용
- **3D 모델 차량**: USDZ/SCN 포맷의 3D 차량 모델을 지도 위에 렌더링 (SceneKit 오버레이)
- 기본 제공 차량 아이콘 프리셋 (세단, SUV, 스포츠카 등)
- 아이콘 크기/색상 커스터마이징

### 5.10 가상 주행 (Virtual Drive)
- 설정한 경로를 **실제 주행 없이 시뮬레이션**으로 미리 체험
- 1x / 2x / 4x / 8x 속도 조절
- 재생 / 일시정지 / 구간 이동 컨트롤
- 음성 안내도 함께 동작 (실제 주행과 동일한 경험)
- 복잡한 경로를 사전에 익히는 용도

### 5.11 개발자 메뉴 (Developer Tools)
- **GPS 경로 녹화**: 실제 주행 중 GPS 데이터를 GPX 파일로 저장
- **GPS 경로 재생**: 저장된 GPX 파일을 로드하여 가상 위치로 재생
- 재생 속도 조절 (0.5x ~ 8x)
- 녹화 데이터: 좌표, 속도, 방향, 고도, 타임스탬프
- 개발/디버깅 및 경로 테스트 용도
- 설정 > 개발자 옵션에서 접근 (릴리즈 빌드에서는 숨김 처리)

---

## 6. 부가 기능 (Post-MVP)

### Phase 2
- 경유지 추가 (다중 목적지)
- 즐겨찾기 폴더 관리
- 최근 경로 기록 및 재안내
- 잠금화면 Live Activity (남은 거리/시간)
- 위젯 (자주 가는 곳 바로 안내)

### Phase 3
- Siri Shortcuts ("집으로 안내해줘")
- 도착 예정 시간 공유 (메시지)
- 야간 모드 (다크맵)
- 속도 제한 표시 (가능한 경우)
- 주차 위치 기억

### Phase 4
- 오프라인 지도 (Mapbox 검토)
- Apple Watch 연동 (도보 안내)
- 교통 정보 실시간 반영
- PaceTracker 연동 (운동 경로 네비)

---

## 7. 화면 구성

### 7.1 메인 화면 (Home) - 기본 상태
```
┌─────────────────────────┐
│  🔍 여기서 검색           │  ← 검색 바 (현재 지도 영역 기준)
├─────────────────────────┤
│                         │
│                         │
│       [ 지 도 ]         │  ← 현재 위치 중심 지도
│         📍              │  ← 현재 위치
│                         │
│                         │
├─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─┤  ← 드로어 (최소 높이)
│  🏠 집  🏢 회사  ⭐ ...  │  ← 즐겨찾기 바로가기
│  📍 최근: 강남역         │  ← 최근 검색 (1~2개만)
└─────────────────────────┘
```

### 7.2-A 검색 바 탭 → 자동완성 모드
```
┌─────────────────────────┐
│  ← 🔍 [검색어 입력|]     │  ← 키보드 활성 + 자동완성
├─────────────────────────┤
│  🏠 집       서울 강남구  │  ← 즐겨찾기
│  🏢 회사     서울 종로구  │
├─────────────────────────┤
│  🕐 강남역               │
│  🕐 스타벅스 역삼점       │  ← 최근 검색 기록
│  🕐 이마트 성수점         │
├─────────────────────────┤  (입력 시작하면 아래로 전환)
│  📍 스타벅스 역삼점       │
│  📍 스타벅스 강남R점      │  ← 자동완성 결과
│  📍 스타벅스 선릉점       │
│  ...                    │
└─────────────────────────┘
      [ 키 보 드 ]
```

### 7.2-B 검색 결과 → 지도 마커 + 드로어 리스트
```
┌─────────────────────────┐
│  ← 🔍 스타벅스      [×]  │  ← 검색어 표시
├─────────────────────────┤
│       📍B               │
│                 📍C      │
│    [ 지 도 ]            │  ← 결과 마커들 표시
│              📍A ←강조   │  ← 리스트 최상단 항목 포커싱
│       📍D               │
│                         │
├═══════════════ ━ ━ ━ ━ ━┤  ← 드로어 (중간 높이, 드래그로 조절)
│  ≡ 4개 결과              │  ← 드로어 핸들
│ ┌─────────────────────┐ │
│ │📍 A. 스타벅스 역삼점  │←│── 최상단 = 지도 포커싱
│ │   역삼동 123 · 350m  │ │
│ ├─────────────────────┤ │
│ │📍 B. 스타벅스 강남R점 │ │  ← 드로어 내부 스크롤
│ │   강남동 456 · 1.2km │ │
│ ├─────────────────────┤ │
│ │📍 C. 스타벅스 선릉점  │ │
│ │   선릉동 789 · 1.8km │ │
│ └─────────────────────┘ │
└─────────────────────────┘
```

### 7.2-C 드로어 스크롤 → 지도 포커스 연동
```
┌─────────────────────────┐
│  ← 🔍 스타벅스      [×]  │
├─────────────────────────┤
│                         │
│              📍B ←강조   │  ← B가 리스트 최상단이 되면
│    [ 지 도 ]            │     지도가 B로 포커싱
│         📍A             │
│                         │
├═════════════════════════┤
│  ≡ 4개 결과              │
│ ┌─────────────────────┐ │
│ │📍 B. 스타벅스 강남R점 │←│── 스크롤하여 B가 최상단
│ │   강남동 456 · 1.2km │ │
│ ├─────────────────────┤ │
│ │📍 C. 스타벅스 선릉점  │ │
│ │   선릉동 789 · 1.8km │ │
│ └─────────────────────┘ │
└─────────────────────────┘
```

### 7.2-D 드로어 높이 3단계
```
[최소]           [중간]           [전체]
┌──────────┐    ┌──────────┐    ┌──────────┐
│          │    │          │    │ 🔍 검색바  │
│  지 도   │    │  지 도   │    ├──────────┤
│  (넓음)  │    │  (중간)  │    │          │
│          │    ├──────────┤    │  결 과   │
├──────────┤    │ 결과     │    │  리스트  │
│ ≡ 4개    │    │ 리스트   │    │  (전체)  │
│ A. 역삼점│    │ (3~4개)  │    │          │
└──────────┘    └──────────┘    └──────────┘
  지도 중심       균형잡힌         리스트 중심
```

### 7.3 경로 미리보기 (Route Preview)
```
┌─────────────────────────┐
│                         │
│    [ 경로가 표시된 지도 ] │  ← 전체 경로 + 대안 경로
│                         │
├─────────────────────────┤
│  🚗 25분  12.3km        │  ← 추천 경로 (파란색)
│  🚗 32분  14.1km        │  ← 대안 경로 (회색)
├─────────────────────────┤
│     [ 안내 시작 ]        │  ← 큰 버튼
└─────────────────────────┘
```

### 7.4 네비게이션 화면 (Navigation)
```
┌─────────────────────────┐
│  ↗️ 300m 후 우회전       │  ← 다음 안내
│  강남대로                │  ← 다음 도로명
├─────────────────────────┤
│                         │
│    [ 지도 + 경로 ]       │  ← 진행 방향 중심
│       📍                │  ← 현재 위치
│                         │
├─────────────────────────┤
│  60km/h    15분   8.2km │  ← 속도 / 남은시간 / 남은거리
│         [ 종료 ]        │
└─────────────────────────┘
```

### 7.5 CarPlay 화면
```
┌─────────────────────────────────┐
│  ↗️ 300m 후 우회전               │
├─────────────────────────────────┤
│                                 │
│         [ 지도 + 경로 ]          │
│                                 │
├─────────────────────────────────┤
│   15분        8.2km    14:35 도착│
└─────────────────────────────────┘
```

### 7.6 가상 주행 화면 (Virtual Drive)
```
┌─────────────────────────────────┐
│  🎬 가상 주행        [×]        │  ← 모드 표시 + 닫기
│  ↗️ 300m 후 우회전               │
├─────────────────────────────────┤
│                                 │
│    [ 지도 + 경로 시뮬레이션 ]     │  ← 실제 안내와 동일 뷰
│         🚗                      │  ← 커스텀 차량 아이콘
│                                 │
├─────────────────────────────────┤
│  ◀◀  ▶/⏸  ▶▶   [2x]           │  ← 재생 컨트롤 + 배속
│  ──●─────────── 35%             │  ← 진행률 시크바
│  12분/34분      5.2km/14.8km    │  ← 경과/전체 시간·거리
└─────────────────────────────────┘
```

### 7.7-A 회전 지점 팝업 안내
```
┌─────────────────────────────────┐
│  ↗️ 100m 후 우회전               │
├─────────────────────────────────┤
│                                 │
│    [ 메인 지도 - 3D 진행방향 ]    │  ← 메인 지도는 그대로 유지
│         🚗                      │
│                                 │
│   ┌──────────────┐              │
│   │ N↑  정북 2D   │              │  ← 팝업: 정북 고정 탑뷰
│   │              │              │
│   │  ──══════    │              │  ← 올바른 경로 강조 (파란색)
│   │       ╬←회전지점│             │  ← 중심 = 회전 지점 (고정)
│   │       ║      │              │
│   │       ║      │              │
│   │      🚗←현위치 │              │  ← raw GPS 좌표 (경로 스냅 X)
│   │       ║      │              │
│   │  ─────╨──    │              │
│   └──────────────┘              │
│                                 │
├─────────────────────────────────┤
│  60km/h    15분   8.2km         │
└─────────────────────────────────┘
```

### 7.7-B 목적지 도착 팝업 안내
```
┌─────────────────────────────────┐
│  📍 목적지 부근입니다             │
├─────────────────────────────────┤
│                                 │
│    [ 메인 지도 - 3D 진행방향 ]    │  ← 메인 지도는 그대로 유지
│         🚗                      │
│                                 │
│   ┌──────────────┐              │
│   │ N↑  정북 2D   │              │  ← 팝업: 정북 고정 탑뷰
│   │              │              │
│   │       🏁←목적지│              │  ← 중심 = 목적지 좌표 (고정)
│   │       ║      │              │  ← 경로 polyline 강조
│   │       ║      │              │
│   │      🚗←현위치 │              │  ← raw GPS (목적지로 접근 중)
│   │       ║      │              │
│   │  ─────╨──    │              │
│   └──────────────┘              │
│                                 │
├─────────────────────────────────┤
│  60km/h    2분    350m          │
└─────────────────────────────────┘
```

[팝업 공통 구성]
- 중심: 목표 지점 좌표 (회전 지점 or 목적지, 고정)
- 줌 레벨: 300m 전 차량 위치 ~ 목표 지점이 모두 보이는 범위
- 주행 경로: polyline으로 표시 (어디로 가야 하는지 안내)
- 차량 마커: raw GPS 좌표 그대로 표시 (경로에 스냅하지 않음)
  → 메인 지도에서는 경로에 매칭하지만, 팝업에서는 실제 위치 그대로
  → 사용자가 실제 차량 위치와 목표 지점의 관계를 직관적으로 파악
- 차량 이동: 팝업 가장자리에서 출발 → 중심(목표 지점) 향해 리얼타임 이동

[팝업 라이프사이클]
- 회전 지점: 300m 전 페이드인 → 차량 실시간 이동 → 통과 시 페이드아웃
- 목적지 도착: 300m 전 페이드인 → 차량 실시간 접근 → 도착 판정 시 페이드아웃 + 도착 안내

---

## 8. 미니멀 디자인 원칙

1. **색상**: 모노톤 베이스 + 경로 강조색 1개 (블루 계열)
2. **타이포**: 큰 글씨, 높은 대비 (운전 중 가독성)
3. **애니메이션**: 부드럽지만 최소한의 전환
4. **정보 밀도**: 한 화면에 핵심 정보만 (3~4개 이하)
5. **다크 모드**: 기본 지원 (야간 운전)
6. **햅틱**: 회전 지점 접근 시 촉각 피드백

---

## 9. 비기능 요구사항

| 항목 | 요구사항 |
|------|---------|
| 성능 | 경로 탐색 응답 3초 이내 |
| 배터리 | 백그라운드 GPS 최적화 (거리 필터 적용) |
| 메모리 | 네비게이션 중 200MB 이하 |
| 오프라인 | MVP에서는 온라인 필수, 이후 오프라인 검토 |
| 접근성 | VoiceOver 지원, Dynamic Type 지원 |
| 프라이버시 | 위치 데이터 로컬 저장, 서버 전송 없음 |

---

## 10. 수익화 모델 (추후 검토)

- 무료 기본 사용
- 프리미엄 구독: 오프라인 지도, 고급 기능
- 광고 없는 경험 (미니멀 컨셉에 광고는 부적합)
